<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa Midiateca</title>
    
    <!-- leaflet css -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />

    <style>
        body{
            margin: 0;
            padding: 0;
        }
                
        #map{
            width: 100%;
            height: 100vh;
            position: relative;
            z-index: 1;
        }

        .SearchBox {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 400px;
            height: 400px;
            background-color: white;
            border: 2px solid rgba(50, 50, 50, 0.25);
            border-radius: 5px;
            margin: 0;
            padding: 0;
            display: block;
            box-sizing: border-box;
            z-index: 999;
        }

        .SearchBox .header{
            padding: 5px;
            background-color: grey;
            color: white;
            user-select: none;
            border-top-right-radius: 5px;
            border-top-left-radius: 5px;
            cursor: move;
            font-family: "Helvetica Neue", Arial, Helvetica, sans-serif;
            font-size: 1.08333em;
            z-index: 999;
        }

        .year-input{
            width: 100%;
            display: flex;
            margin: 30px 0 35px;
        }

        .year-input .field{
            display: flex;
            width: 100%;
            margin: 30px 0 35px;
        }

        .field input{
            width: 100%;
            height: 100%;
            outline: none;
            margin-left: 12px;
            border-radius: 5px;
            text-align: center;
            border: 1px solid grey;
            -moz-appearance: textfield;
        }

        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
        }

        .year-input .separator{
            width: 130px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .slider{
            height: 5px;
            position: relative;
            background: white;
            border-radius: 5px;
        }

        .slider .progress{
            height: 100%;
            left: 25%;
            right: 25%;
            position: absolute;
            border-radius: 5px;
            background: #E30425;
        }

        .range-input{
            position: relative;
        }

        .range-input input{
            position: absolute;
            width: 100%;
            height: 5px;
            top: -5px;
            background: none;
            pointer-events: none;
            -webkit-appearance: none;
            -moz-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb{
            height: 17px;
            width: 17px;
            border-radius: 50%;
            background: #E30425;
            pointer-events: auto;
            -webkit-appearance: none;
            box-shadow: 0 0 6px rgba(0,0,0,0.05);
        }

        input[type="range"]::-moz-range-thumb{
            height: 17px;
            width: 17px;
            border: none;
            border-radius: 50%;
            background: #E30425;
            pointer-events: auto;
            -moz-appearance: none;
            box-shadow: 0 0 6px rgba(0,0,0,0.05);
        }

        </style>

</head>
<body>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
    <script src="./data/map.js"></script>

    <div id="map"></div>
    
    <div class="SearchBox">
        <div class="header">Aba de pesquisa</div>
        <div class="year-input">
            <div class="field">
                <span>Min</span>
                <input type="number" class="input-min" value="2500">
            </div>
            <div class="separator">-</div>
            <div class="field">
                <span>Max</span>
                <input type="number" class="input-max" value="7500">
            </div>
        </div>
        <div class="slider">
            <div class="progress"></div>
        </div>
        <div class="range-input">
            <input type="range" class="range-min" min="0" max="10000" value="2500" step="100">
            <input type="range" class="range-max" min="0" max="10000" value="7500" step="100">
        </div>
    </div>
    
    <script>
        const rangeInput = document.querySelectorAll(".range-input input"),
        priceInput = document.querySelectorAll(".price-input input"),
        range = document.querySelector(".slider .progress");
        let priceGap = 1000;

        priceInput.forEach(input =>{
            input.addEventListener("input", e =>{
                let minPrice = parseInt(priceInput[0].value),
                maxPrice = parseInt(priceInput[1].value);
                
                if((maxPrice - minPrice >= priceGap) && maxPrice <= rangeInput[1].max){
                    if(e.target.className === "input-min"){
                        rangeInput[0].value = minPrice;
                        range.style.left = ((minPrice / rangeInput[0].max) * 100) + "%";
                    }else{
                        rangeInput[1].value = maxPrice;
                        range.style.right = 100 - (maxPrice / rangeInput[1].max) * 100 + "%";
                    }
                }
            });
        });

        rangeInput.forEach(input =>{
            input.addEventListener("input", e =>{
                let minVal = parseInt(rangeInput[0].value),
                maxVal = parseInt(rangeInput[1].value);

                if((maxVal - minVal) < priceGap){
                    if(e.target.className === "range-min"){
                        rangeInput[0].value = maxVal - priceGap
                    }else{
                        rangeInput[1].value = minVal + priceGap;
                    }
                }else{
                    priceInput[0].value = minVal;
                    priceInput[1].value = maxVal;
                    range.style.left = ((minVal / rangeInput[0].max) * 100) + "%";
                    range.style.right = 100 - (maxVal / rangeInput[1].max) * 100 + "%";
                }
            });
        });
    </script>
    
    <script>       
        // torna a div flutuante arrastável
        var SearchBox = document.querySelector('.SearchBox');
        var header = document.querySelector('.header');

        var InitialPosition = { x: 0, y: 0};
        var CurrentPosition = { x: 0, y: 0};
        var FinalPosition = { x: 0, y: 0};

        var dragSearchBox = function(event){
            CurrentPosition.x = event.clientX - InitialPosition.x;
            CurrentPosition.y = event.clientY - InitialPosition.y;

            SearchBox.style.top = Math.max(0, CurrentPosition.y) + 'px';
            SearchBox.style.left = Math.max(0, CurrentPosition.x) + 'px';
        };

        var dropSearchBox = function(){
            FinalPosition.x = CurrentPosition.x;
            FinalPosition.y = CurrentPosition.y;

            document.removeEventListener('mousemove', dragSearchBox);
            document.removeEventListener('mouseup', dropSearchBox);
        };

        header.addEventListener('mousedown', function(event){
            InitialPosition.x = event.clientX - SearchBox.offsetLeft;
            InitialPosition.y = event.clientY - SearchBox.offsetTop;

            document.addEventListener('mousemove', dragSearchBox);
            document.addEventListener('mouseup', dropSearchBox);
        });

        </script>
    
    
    
    
    <!-- leaflet js -->
    
    
    <script>
        //map initialization
        var map = L.map('map').setView([-19.700, -40.500], 7.5);
        
        
        /******************************
                    LAYERS
        *******************************/
        
        
        //OPEN STREET MAP
        var osm = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        });
        osm.addTo(map);
        
        
        //GOOGLE MAP
        var GoogleStreets = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}',{
            maxZoom: 20,
            subdomains:['mt0','mt1','mt2','mt3']
        });
        //GoogleStreets.addTo(map);
        
        
        //GOOGLE SATELITE MAP
        var GoogleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
            maxZoom: 20,
            subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
        });
        // GoogleSat.addTo(map)
        
        
        /*var popup = L.popup([-20.320579377361447, -40.33857921005433], {content: '<p>Hello world!<br />This is a nice popup.</p>'});
        popup.openOn(map);
        POPUP que abre sem que seja clicado em algum lugar*/
        
        
        /************************
                GeoJSON 
        *************************/
        
        var todos_data = L.geoJSON(mapJson, {
            onEachFeature: function (feature, layer) {
                layer.bindPopup('<b>Tipo: </b>' + feature.properties.TIPO + '<br>'
                + '<b>Obra: </b>' + feature.properties.OBRA + '<br>'
                + '<b>Autor: </b>' + feature.properties.AUTOR + '<br>'
                + '<b>Data: </b>' + feature.properties.DATA + '<br>'
                + '<b>Cidade: </b>' + feature.properties.CIDADE + '<br>'
                + '<b>Instituição: </b>' + feature.properties.INSTITUIÇÃO + '<br>'
                + '<b>UF: </b>' + feature.properties.UF + '<br>'
                + '<b>Acesso: </b>' + '<a href=' + feature.properties.ACESSO + '>Clique aqui!</a>'+ '<br>'
                )
            }
        }).addTo(map)
        
        /************************
            Layer controller
        *************************/
        
        var baseMaps = {
            "OpenStreetMap": osm,
            "Google Maps": GoogleStreets,
            "Google Satelite": GoogleSat 
        };

        L.control.layers(baseMaps, null, {collapsed: false}).addTo(map);   
    </script>

</body>
</html>